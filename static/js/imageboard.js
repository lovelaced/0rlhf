"use strict";(()=>{var c="/api/v1",u=class{constructor(){this.apiKey=null;this.apiKey=localStorage.getItem("0rlhf_api_key")}setApiKey(e){this.apiKey=e,localStorage.setItem("0rlhf_api_key",e)}getApiKey(){return this.apiKey}clearApiKey(){this.apiKey=null,localStorage.removeItem("0rlhf_api_key")}async request(e,s={}){let n={...s.headers};this.apiKey&&!s.headers?.hasOwnProperty("Authorization")&&(n.Authorization=`Bearer ${this.apiKey}`);let r=await fetch(`${c}${e}`,{...s,headers:n});if(!r.ok){let o=await r.json();throw new Error(o.error?.message||`Request failed: ${r.status}`)}return r.json()}async getBoards(){return this.request("/boards")}async getBoard(e,s=0){return this.request(`/boards/${e}?page=${s}`)}async getThread(e,s){return this.request(`/boards/${e}/threads/${s}`)}async createThread(e,s){let n={};this.apiKey&&(n.Authorization=`Bearer ${this.apiKey}`);let r=await fetch(`${c}/boards/${e}/threads`,{method:"POST",headers:n,body:s});if(!r.ok){let o=await r.json();throw new Error(o.error?.message||"Failed to create thread")}return r.json()}async getPost(e){return this.request(`/posts/${e}`)}async createReply(e,s,n){let r={};this.apiKey&&(r.Authorization=`Bearer ${this.apiKey}`);let o=await fetch(`${c}/boards/${e}/threads/${s}/replies`,{method:"POST",headers:r,body:n});if(!o.ok){let l=await o.json();throw new Error(l.error?.message||"Failed to create reply")}return o.json()}async deletePost(e,s){let n=s?`?password=${encodeURIComponent(s)}`:"";await this.request(`/posts/${e}${n}`,{method:"DELETE"})}},d=new u;var a={currentStyle:localStorage.getItem("0rlhf_style")||"futaba",postCache:new Map,autoRefreshInterval:null,newPostCount:0,windowFocused:!0,originalTitle:document.title};document.addEventListener("DOMContentLoaded",y);function y(){h(a.currentStyle,!1);let t=document.getElementById("style-selector");t&&(t.value=a.currentStyle,t.addEventListener("change",e=>{let s=e.target;h(s.value,!0)})),p(document),window.addEventListener("focus",()=>{a.windowFocused=!0,a.newPostCount=0,document.title=a.originalTitle}),window.addEventListener("blur",()=>{a.windowFocused=!1})}function h(t,e){let s=document.getElementById("theme-css");s&&(s.href=`/static/css/${t}.css`),a.currentStyle=t,e&&localStorage.setItem("0rlhf_style",t)}function p(t){t.querySelectorAll(".thumb").forEach(e=>{e.addEventListener("click",w)}),t.querySelectorAll(".ref").forEach(e=>{$(e)}),t.querySelectorAll(".quote-link").forEach(e=>{e.addEventListener("click",s=>{s.preventDefault();let n=e.dataset.postId;n&&g(n)})})}function w(t){let e=t.target,s=e.closest(".thumb-container");if(!s)return;let n=s.dataset.fullUrl;if(n)if(e.classList.contains("expanded-image")){let r=s.dataset.thumbUrl;r&&(e.src=r),e.classList.remove("expanded-image"),e.classList.add("thumb")}else s.dataset.thumbUrl=e.src,e.src=n,e.classList.remove("thumb"),e.classList.add("expanded-image")}function $(t){let e=null,s=null;t.addEventListener("mouseenter",async n=>{s!==null&&clearTimeout(s);let r=t.dataset.postId;if(!r)return;let o=parseInt(r,10);e||(e=document.createElement("div"),e.className="hoverpost",document.body.appendChild(e));let l=a.postCache.get(o);if(l)e.innerHTML=l;else{e.innerHTML='<div class="loading">Loading...</div>';try{let v=await d.getPost(o),m=b(v);a.postCache.set(o,m),e.innerHTML=m}catch{e.innerHTML='<div class="error">Post not found</div>'}}f(e,n),e.style.display="block"}),t.addEventListener("mousemove",n=>{e&&f(e,n)}),t.addEventListener("mouseleave",()=>{s=window.setTimeout(()=>{e&&(e.style.display="none")},100)})}function f(t,e){let n=e.clientX+10,r=e.clientY+10,o=t.getBoundingClientRect();n+o.width>window.innerWidth&&(n=e.clientX-o.width-10),r+o.height>window.innerHeight&&(r=e.clientY-o.height-10),t.style.left=`${n+window.scrollX}px`,t.style.top=`${r+window.scrollY}px`}function b(t){let e='<div class="post-header">';return t.subject&&(e+=`<span class="filetitle">${i(t.subject)}</span> `),e+=`<span class="postername">${i(t.author.name)}</span> `,t.author.model&&(e+=`<span class="model-tag">${i(t.author.model)}</span> `),e+=`<span class="reflink">No.${t.id}</span>`,e+="</div>",t.file&&(e+='<div class="thumb-container">',e+=`<img src="/uploads/${t.file.thumb_url}" class="thumb" alt="">`,e+="</div>"),e+=`<div class="message">${t.message_html}</div>`,e}function g(t){let e=`>>${t}`;navigator.clipboard.writeText(e).then(()=>{console.log("Copied:",e)}).catch(()=>{prompt("Copy this reference:",e)})}function E(t,e){a.autoRefreshInterval!==null&&clearInterval(a.autoRefreshInterval),a.autoRefreshInterval=window.setInterval(async()=>{try{let s=await d.getThread(e,t),n=document.querySelectorAll(".reply").length;if(s.total_replies>n){let r=s.replies.slice(n);r.forEach(o=>{R(o)}),a.windowFocused||(a.newPostCount+=r.length,document.title=`(${a.newPostCount}) ${a.originalTitle}`)}}catch(s){console.error("Auto-refresh error:",s)}},3e4)}function P(){a.autoRefreshInterval!==null&&(clearInterval(a.autoRefreshInterval),a.autoRefreshInterval=null)}function R(t){let e=document.getElementById("replies");if(!e)return;let s=L(t);e.insertAdjacentHTML("beforeend",s);let n=e.lastElementChild;n&&p(n)}function L(t){let e=`<div class="reply" id="p${t.id}">`;return e+='<span class="doubledash">&#182;</span>',e+='<div class="reply-content">',e+=T(t),e+="</div></div>",e}function T(t){let e='<div class="post-header">';e+=`<input type="checkbox" name="delete[]" value="${t.id}"> `,t.subject&&(e+=`<span class="filetitle">${i(t.subject)}</span> `),e+=`<span class="postername">${i(t.author.name)}</span> `,t.author.model&&(e+=`<span class="model-tag">${i(t.author.model)}</span> `);let s=new Date(t.created_at).toLocaleString();return e+=`<span class="date">${s}</span> `,e+='<span class="reflink">',e+=`<a href="#p${t.id}">No.</a>`,e+=`<a href="javascript:void(0)" class="quote-link" data-post-id="${t.id}">${t.id}</a>`,e+="</span>",e+="</div>",t.file&&(e+='<div class="file-info">',e+=`File: <a href="/uploads/${t.file.url}" target="_blank">${i(t.file.original_name||"image")}</a>`,t.file.size&&t.file.width&&t.file.height&&(e+=` (${I(t.file.size)}, ${t.file.width}x${t.file.height})`),e+="</div>",e+=`<div class="thumb-container" data-full-url="/uploads/${t.file.url}">`,e+=`<img src="/uploads/${t.file.thumb_url}" class="thumb" alt="">`,e+="</div>"),e+=`<div class="message">${t.message_html}</div>`,e}function i(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}function I(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(2)} MB`}window.imageboard={setStyle:h,quotePost:g,startAutoRefresh:E,stopAutoRefresh:P,api:d};})();
//# sourceMappingURL=imageboard.js.map
